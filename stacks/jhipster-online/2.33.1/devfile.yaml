schemaVersion: 2.2.0
metadata:
  name: jhipster-online
  version: 2.33.1
  description: "Stack with JHipster Online on Red Hat OpenShift Dev Spaces. 
    This stack include:
    - JHipster 8.8.0. for generate Spring Boot 3.4.1 projects.
    - generator-jhipster-micronaut 3.6.0 for generate Micronaut 4.7.2 projects.
    - generator-jhipster-quarkus 3.4.0 for generate Quarkus 3.11.1 projects.
    - generator-jhipster-dotnetcore 4.2.0 for generate .Net 8.0 projects.
    Watch the demo video:
    - https://youtu.be/b7xbcTAGNIQ?si=snE57Th4S3gPv_Vn"    
  displayName: JHipster Online
  icon: https://raw.githubusercontent.com/redhat-developer-demos/jhipster-online/main/jhipster-icon.png
  website: https://start.jhipster.tech
  tags:
    - Java
    - JHipster
    - Angular
    - Spring
    - Quarkus
    - Micronaut
  language: Java
  projectType: springboot
projects:
  - name: jhipster-online
    git:
      remotes:
        origin: 'https://github.com/redhat-developer-demos/jhipster-online'
      checkoutFrom:
        revision: main
components:
  - name: tools
    container:
      image: 'quay.io/devfile/jhipster-online@sha256:1f284df66c8ef209ea2cd1a10516e9ba424508a11341eead650e88027858d3ee'
      mountSources: true
      cpuLimit: '4'
      cpuRequest: '1'
      memoryLimit: '8G'
      memoryRequest: '4G'
      volumeMounts:
        - name: m2
          path: /home/user/.m2
        - name: config
          path: /home/user/.config
        - name: npm
          path: /home/user/.npm
      endpoints:
        - exposure: public
          name: backend
          protocol: https
          targetPort: 8080
        - exposure: public
          name: debug
          targetPort: 4200
        - exposure: public
          name: frontend
          protocol: https
          targetPort: 9000
        - exposure: public
          name: debug-frontend
          protocol: https
          targetPort: 9001
        - exposure: public
          name: browser-sync
          protocol: https
          targetPort: 3001
      env:
        - value: '-XX:MaxRAMPercentage=50.0 -XX:+UseParallelGC -XX:MinHeapFreeRatio=10 -XX:MaxHeapFreeRatio=20 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90 -Dsun.zip.disableMemoryMapping=true -Xms20m -Djava.security.egd=file:/dev/./urandom -Duser.home=/home/jboss'
          name: JAVA_OPTS
        - value: $(JAVA_OPTS)
          name: MAVEN_OPTS
        - value: '/home/tooling/.sdkman/candidates/java/11.0.15-tem'
          name: JAVA_HOME
  - name: m2
    volume:
      size: 512Mi
  - name: config
    volume:
      size: 512Mi
  - name: npm
    volume:
      size: 512Mi
commands:
  - id: kubectl-add-mysql
    exec:
      label: 'Kubernetes apply MariaDB Instance (Kubernetes cluster)'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'kubectl apply -f src/main/kubernetes/mysql.yaml'
  - id: oc-add-mysql
    exec:
      label: 'OpenShift apply MariaDB Instance (OpenShift cluster)'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'oc apply -f src/main/kubernetes/mysql.yaml'
  - id: oc-remove-mysql
    exec:
      label: 'OpenShift remove MariaDB Instance (OpenShift cluster)'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'oc delete all --selector app=mariadb'
  - id: yarn-install
    exec:
      label: 'Package the application'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'yarn install'
      group:
        kind: build
        isDefault: true
  - id: start-frontend
    exec:
      label: 'Start Frontend'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'yarn start'
      group:
        kind: run
        isDefault: true
  - id: start-backend
    exec:
      label: 'Start JHipster Online'
      component: tools
      workingDir: ${PROJECT_SOURCE}
      commandLine: 'chmod 777 ./mvnw && ./mvnw'
      group:
        kind: run
        isDefault: false
events:
  postStart:
    - oc-add-mysql
    - yarn-install